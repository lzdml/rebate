import{n as P,a6 as y,f as D,Q as W,O as E,P as q,Y as z,aL as Q,ax as L,v as k,c as R,d as _,Z as N,e as d,aM as $,W as F,X,aa as K,C as M,D as p,w as Y,R as T,h as J,a0 as ee,a5 as oe,a8 as ne,am as te,aN as ae,aO as se,F as le,aP as ce,an as re,ae as ie,aF as ue,aq as de}from"./index-22429aee.js";import{u as fe}from"./use-expose-39e918a8.js";import{u as ve}from"./use-touch-bf80857b.js";const ye={show:Boolean,zIndex:P,overlay:y,duration:P,teleport:[String,Object],lockScroll:y,lazyRender:y,beforeClose:Function,overlayStyle:Object,overlayClass:D,transitionAppear:Boolean,closeOnClickOverlay:y};let h=0;const A="van-overflow-hidden";function me(e,o){const t=ve(),f="01",a="10",c=r=>{t.move(r);const v=t.deltaY.value>0?a:f,S=Q(r.target,e.value),{scrollHeight:m,offsetHeight:O,scrollTop:w}=S;let i="11";w===0?i=O>=m?"00":"01":w+O>=m&&(i="10"),i!=="11"&&t.isVertical()&&!(parseInt(i,2)&parseInt(v,2))&&L(r,!0)},s=()=>{document.addEventListener("touchstart",t.start),document.addEventListener("touchmove",c,{passive:!1}),h||document.body.classList.add(A),h++},l=()=>{h&&(document.removeEventListener("touchstart",t.start),document.removeEventListener("touchmove",c),h--,h||document.body.classList.remove(A))},x=()=>o()&&s(),I=()=>o()&&l();W(x),E(I),q(I),z(o,r=>{r?s():l()})}function j(e){const o=k(!1);return z(e,t=>{t&&(o.value=t)},{immediate:!0}),t=>()=>o.value?t():null}const[he,Ie]=R("overlay"),Oe={show:Boolean,zIndex:P,duration:P,className:D,lockScroll:y,lazyRender:y,customStyle:Object};var we=_({name:he,props:Oe,setup(e,{slots:o}){const t=k(),f=j(()=>e.show||!e.lazyRender),a=s=>{e.lockScroll&&L(s,!0)},c=f(()=>{var s;const l=F(X(e.zIndex),e.customStyle);return K(e.duration)&&(l.animationDuration=`${e.duration}s`),M(d("div",{ref:t,style:l,class:[Ie(),e.className]},[(s=o.default)==null?void 0:s.call(o)]),[[p,e.show]])});return N("touchmove",a,{target:t}),()=>d($,{name:"van-fade",appear:!0},{default:c})}});const Ce=Y(we),Pe=F({},ye,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ke,B]=R("popup");var xe=_({name:ke,inheritAttrs:!1,props:Pe,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:t,slots:f}){let a,c;const s=k(),l=k(),x=j(()=>e.show||!e.lazyRender),I=J(()=>{const n={zIndex:s.value};if(K(e.duration)){const u=e.position==="center"?"animationDuration":"transitionDuration";n[u]=`${e.duration}s`}return n}),r=()=>{a||(a=!0,s.value=e.zIndex!==void 0?+e.zIndex:ce(),o("open"))},v=()=>{a&&ie(e.beforeClose,{done(){a=!1,o("close"),o("update:show",!1)}})},S=n=>{o("clickOverlay",n),e.closeOnClickOverlay&&v()},m=()=>{if(e.overlay)return d(Ce,{show:e.show,class:e.overlayClass,zIndex:s.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:S},{default:f["overlay-content"]})},O=n=>{o("clickCloseIcon",n),v()},w=()=>{if(e.closeable)return d(de,{role:"button",tabindex:0,name:e.closeIcon,class:[B("close-icon",e.closeIconPosition),ue],classPrefix:e.iconPrefix,onClick:O},null)};let i;const G=()=>{i&&clearTimeout(i),i=setTimeout(()=>{o("opened")})},H=()=>o("closed"),U=n=>o("keydown",n),Z=x(()=>{var n;const{round:u,position:C,safeAreaInsetTop:b,safeAreaInsetBottom:V}=e;return M(d("div",re({ref:l,style:I.value,role:"dialog",tabindex:0,class:[B({round:u,[C]:C}),{"van-safe-area-top":b,"van-safe-area-bottom":V}],onKeydown:U},t),[(n=f.default)==null?void 0:n.call(f),w()]),[[p,e.show]])}),g=()=>{const{position:n,transition:u,transitionAppear:C}=e,b=n==="center"?"van-fade":`van-popup-slide-${n}`;return d($,{name:u||b,appear:C,onAfterEnter:G,onAfterLeave:H},{default:Z})};return z(()=>e.show,n=>{n&&!a&&(r(),t.tabindex===0&&ee(()=>{var u;(u=l.value)==null||u.focus()})),!n&&a&&(a=!1,o("close"))}),fe({popupRef:l}),me(l,()=>e.show&&e.lockScroll),N("popstate",()=>{e.closeOnPopstate&&(v(),c=!1)}),oe(()=>{e.show&&r()}),ne(()=>{c&&(o("update:show",!0),c=!1)}),E(()=>{e.show&&e.teleport&&(v(),c=!0)}),te(ae,()=>e.show),()=>e.teleport?d(se,{to:e.teleport},{default:()=>[m(),g()]}):d(le,null,[m(),g()])}});const ze=Y(xe);export{ze as P};
